<!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>pathvisio.js renderer</title>

<!-- 
Style guides can be arbitrary, but for sake of consistency within this project, let's use these:
http://google-styleguide.googlecode.com/svn/trunk/htmlcssguide.xml
http://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml
http://google-styleguide.googlecode.com/svn/trunk/jsoncstyleguide.xml#General_Guidelines
-->

<!--
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" media="screen">
-->
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" media="screen">

<link id="pathvisio-js-css" rel="stylesheet" href="../src/css/pathvisio-js.css" media="screen">
<link id="details-frame-css" rel="stylesheet" href="../src/css/details-frame.css" media="screen">
<link id="pan-zoom-css" rel="stylesheet" href="../src/css/pan-zoom.css" media="screen">

<!--[if lt IE 9]>
<script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script>
<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<script src="../lib/es5-shim/es5-shim.js"></script>
<script src="../lib/Xccessors/xccessors-standard.js"></script>

<script>

// IE8 only allows console.log when Developer Tools is open. This will prevent errors
// from showing up if I use console.log without DevTools being open.
// from http://stackoverflow.com/questions/3326650/console-is-undefined-error-for-internet-explorer

/**
 * Protect window.console method calls, e.g. console is not defined on IE
 * unless dev tools are open, and IE doesn't define console.debug
 */
(function() {
  if (!window.console) {
    window.console = {};
      }
      // union of Chrome, FF, IE, and Safari console methods
      var m = [
        "log", "info", "warn", "error", "debug", "trace", "dir", "group",
        "groupCollapsed", "groupEnd", "time", "timeEnd", "profile", "profileEnd",
        "dirxml", "assert", "count", "markTimeline", "timeStamp", "clear"
        ];
      // define undefined methods as noops to prevent errors
      for (var i = 0; i < m.length; i++) {
        if (!window.console[m[i]]) {
          window.console[m[i]] = function() {};
        }    
      } 
    })();
  </script>
<![endif]-->

<script src="../lib/rgb-color/rgb-color.min.js"></script>
<script src="../lib/case-converter/case-converter.min.js"></script>
<script src="../lib/xml2json/xml2json.min.js"></script>

<script id="pathvisio-js" src="../build/js/pathvisio.min.js"></script>

<script src="../lib/d3/d3.min.js" charset="utf-8"></script>
<script>
var currentUrlWithoutQueryString = window.location.href.split("?")[0].split("#")[0];

if (!pathvisio.helpers.getUrlParam('svgView')) {
  var svgView = 1;
}
else {
  var svgView = pathvisio.helpers.getUrlParam('svgView');
};

var svgUrl = self.svgUrl = null;
var repo = 'wikipathways';
console.log(pathvisio.helpers.getUrlParam('svg'));
if (!!pathvisio.helpers.getUrlParam('repo')) {
  repo = pathvisio.helpers.getUrlParam('repo');
  var branch = 'master';
  if (!!pathvisio.helpers.getUrlParam('repo')) {
    branch = pathvisio.helpers.getUrlParam('branch');
  }
  svgUrl = '../remote-data-sources/php/github.php?repo=' + repo + '&branch=' + branch + '&relativeUrl=/src/views/pathway-template.svg&mimeType=image/svg+xml';
}
else {
  if (!!pathvisio.helpers.getUrlParam('svg')) {
    var svgSource = pathvisio.helpers.getUrlParam('svg');
    console.log('SVG Source');
    console.log(svgSource);
    svgUrl = svgSource;
  }
  else {
    svgUrl = "./pathway-template.svg";
    console.log('Error: No URL or repo specified as SVG template source.');
    console.log('Using local pathway-template.svg as last resort.');
  }
}

if (!!pathvisio.helpers.getUrlParam('gpml')) {
  var rev = 0;
  if (!!pathvisio.helpers.getUrlParam('rev')) {
    rev = pathvisio.helpers.getUrlParam('rev');
  }

  var gpmlSource = pathvisio.helpers.getUrlParam('gpml');
  ///*
  // gpmlSource is a WikiPathways ID
  if (gpmlSource.indexOf('.gpml') === -1 && gpmlSource.indexOf('.xml') === -1) { // if gpmlSource is a WikiPathways ID
    var gpmlUrl = currentUrlWithoutQueryString + '/../../remote-data-sources/php/wikipathways.php?data=gpml&id=' + gpmlSource + '&rev=' + rev;
  }
  
  else { // if gpmlSource is a url to a gpml file
    var gpmlUrl = gpmlSource;
  };
  //*/

  /*
  if (pathvisio.helpers.isUrl(gpmlSource)) {
    var gpmlUrl = gpmlSource;
  }
  else {
    var gpmlUrl = currentUrlWithoutQueryString + '/../../../remote-data-sources/php/wikipathways.php?data=gpml&id=' + gpmlSource;
  };
  //*/
}
else {
  console.warn('Error: No GPML data source specified.');
};


</script>

</head>
<body>
    <div id="pathvisio-js-container">
    </div>

<script src="../lib/jquery/jquery.min.js"></script>
<script src="../lib/jquery-ui/ui/minified/jquery-ui.min.js"></script>
<script src="../lib/typeahead.js/dist/typeahead.min.js"></script>

<script src="../lib/openseadragon/openseadragon.min.js"></script>
<script src="../lib/modernizr/modernizr.min.js"></script>
<script src="../lib/screenfull/dist/screenfull.min.js"></script>
<script src="../lib/mr-data-converter/CSVParser.min.js"></script>
<script src="../lib/mr-data-converter/DataGridRenderer.min.js"></script>
<script src="../lib/svg-pan/svg-pan1.js"></script>
<!--
<script src="../lib/async/lib/async.js"></script>
-->


<script>
  //pathvisio.pathway.load('#pathway-container', svgUrl, gpmlUrl, '#highlight-by-label');
  pathvisio.pathway.load({
    container: '#pathvisio-js-container',
    width: 1000,
    height: 500,
    zoom: 'fit',
    gpmlUrl: gpmlUrl,
    cssUrl: '',
    customShapes: [
      //{'id': 'mitochondria','url': 'http://127.0.0.1/~andersriutta/pathvisio.js/remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/mitochondria.svg'},
      {'id': 'mitochondria','url': 'http://127.0.0.1/~andersriutta/pathvisio.js/src/views/symbols/mitochondria.svg'},
      {'id': 'brace', 'url': 'http://127.0.0.1/~andersriutta/pathvisio.js/remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/brace.svg'}
    ],
    highlightNodes: [
      {'parameter': 'label', 'parameterValue': 'CRH', 'color': 'red'},
      {'parameter': 'xref', 'parameterValue': '8525,Entrez%20Gene', 'color': '#FF0000'}
    ],
    hiddenElements: [
      'find',
      'wikipathways-link'
    ]
  });
</script>
</body>
