<!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>pathvisio.js dev</title>

<!-- 
Style guides can be arbitrary, but for sake of consistency within this project, let's use these:
http://google-styleguide.googlecode.com/svn/trunk/htmlcssguide.xml
http://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml
http://google-styleguide.googlecode.com/svn/trunk/jsoncstyleguide.xml#General_Guidelines
-->

<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" media="screen">
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" media="screen">

<link id="pathvisio-js-css" rel="stylesheet" href="../src/css/pathvisio-js.css" media="screen">
<link id="details-frame-css" rel="stylesheet" href="../src/css/details-frame.css" media="screen">
<link id="pan-zoom-css" rel="stylesheet" href="../src/css/pan-zoom.css" media="screen">

<!--[if lt IE 9]>
<script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script>
<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<script src="../lib/es5-shim/es5-shim.js"></script>
<script src="../lib/Xccessors/xccessors-standard.js"></script>

<script>

// IE8 only allows console.log when Developer Tools is open. This will prevent errors
// from showing up if I use console.log without DevTools being open.
// from http://stackoverflow.com/questions/3326650/console-is-undefined-error-for-internet-explorer

/**
 * Protect window.console method calls, e.g. console is not defined on IE
 * unless dev tools are open, and IE doesn't define console.debug
 */
(function() {
  if (!window.console) {
    window.console = {};
      }
      // union of Chrome, FF, IE, and Safari console methods
      var m = [
        "log", "info", "warn", "error", "debug", "trace", "dir", "group",
        "groupCollapsed", "groupEnd", "time", "timeEnd", "profile", "profileEnd",
        "dirxml", "assert", "count", "markTimeline", "timeStamp", "clear"
        ];
      // define undefined methods as noops to prevent errors
      for (var i = 0; i < m.length; i++) {
        if (!window.console[m[i]]) {
          window.console[m[i]] = function() {};
        }    
      } 
    })();
  </script>
<![endif]-->

<script src="../lib/rgb-color/rgb-color.min.js"></script>
<script src="../lib/case-converter/case-converter.min.js"></script>
<script src="../lib/xml2json/xml2json.min.js"></script>
<script src="../lib/async/lib/async.js"></script>

<script src="../src/js/pathvisio/pathvisio.js"></script>
<script src="../src/js/pathvisio/helpers.js"></script>
<script src="../src/js/pathvisio/pathway/pathway.js"></script>
<script src="../src/js/pathvisio/pathway/group.js"></script>
<script src="../src/js/pathvisio/pathway/info-box.js"></script>
<script src="../src/js/pathvisio/pathway/node.js"></script>
<script src="../src/js/pathvisio/pathway/edge/edge.js"></script>
<script src="../src/js/pathvisio/pathway/edge/marker.js"></script>
<script src="../src/js/pathvisio/pathway/edge/point.js"></script>
<script src="../src/js/pathvisio/pathway/edge/path-data.js"></script>
<script src="../src/js/pathvisio/pathway/data-sources.js"></script>
<script src="../src/js/pathvisio/pathway/x-ref.js"></script>

<script src="../lib/d3/d3.min.js" charset="utf-8"></script>
</head>
<body>
    <div id="pathvisio-js-container">
    </div>

<script src="../lib/jquery/jquery.min.js"></script>
<script src="../lib/jquery-ui/ui/minified/jquery-ui.min.js"></script>
<script src="../lib/typeahead.js/dist/typeahead.min.js"></script>

<script src="../lib/openseadragon/openseadragon.min.js"></script>
<script src="../lib/modernizr/modernizr.min.js"></script>
<script src="../lib/screenfull/dist/screenfull.min.js"></script>
<script src="../lib/mr-data-converter/CSVParser.min.js"></script>
<script src="../lib/mr-data-converter/DataGridRenderer.min.js"></script>
<script src="../lib/svg-pan/svg-pan1.js"></script>
<!--
<script src="../lib/async/lib/async.js"></script>
-->


<script>

  // get parameters for calling load in dev version

  var currentUrlWithoutQueryString = window.location.href.split("?")[0].split("#")[0];

  if (!pathvisio.helpers.getUrlParam('svgView')) {
    var svgView = 1;
  }
  else {
    var svgView = pathvisio.helpers.getUrlParam('svgView');
  };

  if (!!pathvisio.helpers.getUrlParam('gpml')) {
    var rev = 0;
    if (!!pathvisio.helpers.getUrlParam('rev')) {
      rev = pathvisio.helpers.getUrlParam('rev');
    }

    var gpmlSource = pathvisio.helpers.getUrlParam('gpml');

    // gpmlSource is a WikiPathways ID

    if (gpmlSource.indexOf('.gpml') === -1 && gpmlSource.indexOf('.xml') === -1) { // if gpmlSource is a WikiPathways ID
      var gpmlUrl = currentUrlWithoutQueryString + '/../../remote-data-sources/php/wikipathways.php?data=gpml&id=' + gpmlSource + '&rev=' + rev;
    }
    
    else { // if gpmlSource is a url to a gpml file
      var gpmlUrl = gpmlSource;
    };

  }
  else {
    console.warn('Error: No GPML data source specified.');
  };

  var path = document.location.origin + document.location.pathname;
  path = path.replace("pathvisio.js/test/pathvisio-js-dev.html", "pathvisio.js/")
  var baseUrl = path + 'remote-data-sources/php/local.php?relativeUrl=';
  if (!!pathvisio.helpers.getUrlParam('account') && !!pathvisio.helpers.getUrlParam('branch')) {
    account = pathvisio.helpers.getUrlParam('account');
    branch = pathvisio.helpers.getUrlParam('branch');
    baseUrl = path + 'remote-data-sources/php/github.php?account=' + account + '&branch=' + branch + '&relativeUrl=';
  }

  // convert partial html and svg template to a string and insert into pathvisioNS array.
  // This work is only for the dev version. The pathvisioNS array with the data from partial
  // html and svg template is included in the production version through a grunt build process.

  var pathvisioNS = [];

  function appendPartialHtml(partialHtmlUrl, callback) {
    d3.html(partialHtmlUrl, function(html) {
      appendSvgTemplate(html, baseUrl + 'views/pathway-template.svg', callback);
    });
  }

  function appendSvgTemplate(partialHtml, svgTemplateUrl, callback) {
    d3.text(svgTemplateUrl, 'text/plain', function(svg) {
      d3.select(partialHtml).select('#pathway-container')[0][0].innerHTML = svg;
      var oSerializer = new XMLSerializer();
      pathvisioNS['tmp/pathvisio-js.html'] = oSerializer.serializeToString(partialHtml);
      callback();
    });
  }

  appendPartialHtml(baseUrl + 'views/pathvisio-js.html', function() {

    // pathvisio.pathway.load(parameters) is all that's required for the production version

    pathvisio.pathway.load({
      container: '#pathvisio-js-container',
      width: 1000,
      height: 500,
      zoom: 'fit',
      gpmlUrl: gpmlUrl,
      cssUrl: baseUrl + 'css/pathway-template.css',
      customShapes: [
        {'id': 'arc', 'url': baseUrl + 'views/symbols/arc.svg'},
        {'id': 'brace', 'url': baseUrl + 'views/symbols/brace.svg'},
        {'id': 'endoplasmic-reticulum', 'url': baseUrl + 'views/symbols/endoplasmic-reticulum.svg'},
        {'id': 'golgi-apparatus', 'url': baseUrl + 'views/symbols/golgi-apparatus.svg'},
        {'id': 'hexagon', 'url': baseUrl + 'views/symbols/hexagon.svg'},
        {'id': 'mim-degradation', 'url': baseUrl + 'views/symbols/mim-degradation.svg'},
        {'id': 'mitochondria', 'url': baseUrl + 'views/symbols/mitochondria.svg'},
        {'id': 'oval', 'url': baseUrl + 'views/symbols/oval.svg'},
        {'id': 'pentagon', 'url': baseUrl + 'views/symbols/pentagon.svg'},
        {'id': 'rectangle', 'url': baseUrl + 'views/symbols/rectangle.svg'},
        {'id': 'rounded-rectangle', 'url': baseUrl + 'views/symbols/rounded-rectangle.svg'},
        {'id': 'sarcoplasmic-reticulum','url': baseUrl + 'views/symbols/sarcoplasmic-reticulum.svg'},
        {'id': 'triangle', 'url': baseUrl + 'views/symbols/triangle.svg'}
      ],
      highlightNodes: [
        {'parameter': 'label', 'parameterValue': 'CRH', 'color': 'red'},
        {'parameter': 'xref', 'parameterValue': '8525,Entrez%20Gene', 'color': '#FF0000'}
      ],
      hiddenElements: [
        'find',
        'wikipathways-link'
      ]
    });
  });

</script>
</body>
