<!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>pathvisio.js renderer</title>

<!-- 
Style guides can be arbitrary, but for sake of consistency within this project, let's use these:
http://google-styleguide.googlecode.com/svn/trunk/htmlcssguide.xml
http://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml
http://google-styleguide.googlecode.com/svn/trunk/jsoncstyleguide.xml#General_Guidelines
-->

<!--
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" media="screen">
-->
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" media="screen">

<link id="pathvisio-js-css" rel="stylesheet" href="../src/css/pathvisio-js.css" media="screen">
<link id="details-frame-css" rel="stylesheet" href="../src/css/details-frame.css" media="screen">
<link id="pan-zoom-css" rel="stylesheet" href="../src/css/pan-zoom.css" media="screen">
<link rel="stylesheet" href="../src/css/pathway-template.css" media="screen">

<!--[if lt IE 9]>
<script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script>
<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<script src="../lib/es5-shim/es5-shim.js"></script>
<script src="../lib/Xccessors/xccessors-standard.js"></script>

<script>

// IE8 only allows console.log when Developer Tools is open. This will prevent errors
// from showing up if I use console.log without DevTools being open.
// from http://stackoverflow.com/questions/3326650/console-is-undefined-error-for-internet-explorer

/**
 * Protect window.console method calls, e.g. console is not defined on IE
 * unless dev tools are open, and IE doesn't define console.debug
 */
(function() {
  if (!window.console) {
    window.console = {};
      }
      // union of Chrome, FF, IE, and Safari console methods
      var m = [
        "log", "info", "warn", "error", "debug", "trace", "dir", "group",
        "groupCollapsed", "groupEnd", "time", "timeEnd", "profile", "profileEnd",
        "dirxml", "assert", "count", "markTimeline", "timeStamp", "clear"
        ];
      // define undefined methods as noops to prevent errors
      for (var i = 0; i < m.length; i++) {
        if (!window.console[m[i]]) {
          window.console[m[i]] = function() {};
        }    
      } 
    })();
  </script>
<![endif]-->

<script src="../lib/rgb-color/rgb-color.min.js"></script>
<script src="../lib/case-converter/case-converter.min.js"></script>
<script src="../lib/xml2json/xml2json.min.js"></script>

<script src="../src/js/pathvisio/pathvisio.js"></script>
<script src="../src/js/pathvisio/helpers.js"></script>
<script src="../src/js/pathvisio/pathway/pathway.js"></script>
<script src="../src/js/pathvisio/pathway/group.js"></script>
<script src="../src/js/pathvisio/pathway/info-box.js"></script>
<script src="../src/js/pathvisio/pathway/node.js"></script>
<script src="../src/js/pathvisio/pathway/edge/edge.js"></script>
<script src="../src/js/pathvisio/pathway/edge/marker.js"></script>
<script src="../src/js/pathvisio/pathway/edge/point.js"></script>
<script src="../src/js/pathvisio/pathway/edge/path-data.js"></script>
<script src="../src/js/pathvisio/pathway/data-sources.js"></script>
<script src="../src/js/pathvisio/pathway/x-ref.js"></script>

<script src="../lib/d3/d3.min.js" charset="utf-8"></script>
<script>
var currentUrlWithoutQueryString = window.location.href.split("?")[0].split("#")[0];

if (!pathvisio.helpers.getUrlParam('svgView')) {
  var svgView = 1;
}
else {
  var svgView = pathvisio.helpers.getUrlParam('svgView');
};

if (!!pathvisio.helpers.getUrlParam('gpml')) {
  var rev = 0;
  if (!!pathvisio.helpers.getUrlParam('rev')) {
    rev = pathvisio.helpers.getUrlParam('rev');
  }

  var gpmlSource = pathvisio.helpers.getUrlParam('gpml');
  ///*
  // gpmlSource is a WikiPathways ID
  if (gpmlSource.indexOf('.gpml') === -1 && gpmlSource.indexOf('.xml') === -1) { // if gpmlSource is a WikiPathways ID
    var gpmlUrl = currentUrlWithoutQueryString + '/../../remote-data-sources/php/wikipathways.php?data=gpml&id=' + gpmlSource + '&rev=' + rev;
  }
  
  else { // if gpmlSource is a url to a gpml file
    var gpmlUrl = gpmlSource;
  };
  //*/

  /*
  if (pathvisio.helpers.isUrl(gpmlSource)) {
    var gpmlUrl = gpmlSource;
  }
  else {
    var gpmlUrl = currentUrlWithoutQueryString + '/../../../remote-data-sources/php/wikipathways.php?data=gpml&id=' + gpmlSource;
  };
  //*/
}
else {
  console.warn('Error: No GPML data source specified.');
};

</script>

</head>
<body>
    <div id="pathvisio-js-container">
    </div>

<script src="../lib/jquery/jquery.min.js"></script>
<script src="../lib/jquery-ui/ui/minified/jquery-ui.min.js"></script>
<script src="../lib/typeahead.js/dist/typeahead.min.js"></script>

<script src="../lib/openseadragon/openseadragon.min.js"></script>
<script src="../lib/modernizr/modernizr.min.js"></script>
<script src="../lib/screenfull/dist/screenfull.min.js"></script>
<script src="../lib/mr-data-converter/CSVParser.min.js"></script>
<script src="../lib/mr-data-converter/DataGridRenderer.min.js"></script>
<script src="../lib/svg-pan/svg-pan1.js"></script>
<!--
<script src="../lib/async/lib/async.js"></script>
-->


<script>

  var account = 'wikipathways';
  if (!!pathvisio.helpers.getUrlParam('account')) {
    account = pathvisio.helpers.getUrlParam('account');
  }

  var branch = 'master';
  if (!!pathvisio.helpers.getUrlParam('branch')) {
    branch = pathvisio.helpers.getUrlParam('branch');
  }

  //pathvisio.pathway.load('#pathway-container', svgUrl, gpmlUrl, '#highlight-by-label');
  var pathvisioNS = [];
  var pvDocumentFragment = null;
  var oSerializer = new XMLSerializer();
  //var pathvisioNS['tmp/pathvisio-js.html'];
  var appendPartialHtml = function(partialHtmlUrl, svgUrl) {
    d3.html(partialHtmlUrl, function(html) {
      pvDocumentFragment = html;
      appendSvg(svgUrl);
    });
  }

  var appendSvg = function(svgUrl) {
    d3.text(svgUrl, 'text/plain', function(svg) {
      d3.select(pvDocumentFragment).select('#pathway-container')[0][0].innerHTML = svg;
      pathvisioNS['tmp/pathvisio-js.html'] = oSerializer.serializeToString(pvDocumentFragment);
      pathvisio.pathway.load({
        container: '#pathvisio-js-container',
        width: 1000,
        height: 500,
        zoom: 'fit',
        gpmlUrl: gpmlUrl,
        cssUrl: '',
        customShapes: [
          //{'id': 'mitochondria','url': 'http://127.0.0.1/~andersriutta/pathvisio.js/remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/mitochondria.svg'},
          {'id': 'arc', 'url': '../remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/arc.svg?account=' + account + '&branch=' + branch},
          {'id': 'brace', 'url': '../remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/brace.svg?account=' + account + '&branch=' + branch},
          {'id': 'endoplasmic-reticulum', 'url': '../remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/endoplasmic-reticulum.svg?account=' + account + '&branch=' + branch},
          {'id': 'golgi-apparatus', 'url': '../remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/golgi-apparatus.svg?account=' + account + '&branch=' + branch},
          {'id': 'hexagon', 'url': '../remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/hexagon.svg?account=' + account + '&branch=' + branch},
          {'id': 'mim-degradation', 'url': '../remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/mim-degradation.svg?account=' + account + '&branch=' + branch},
          {'id': 'mitochondria', 'url': '../remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/mitochondria.svg?account=' + account + '&branch=' + branch},
          {'id': 'oval', 'url': '../remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/oval.svg?account=' + account + '&branch=' + branch},
          {'id': 'pentagon', 'url': '../remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/pentagon.svg?account=' + account + '&branch=' + branch},
          {'id': 'rectangle', 'url': '../remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/rectangle.svg?account=' + account + '&branch=' + branch},
          {'id': 'sarcoplasmic-reticulum','url': '../remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/sarcoplasmic-reticulum.svg?account=' + account + '&branch=' + branch},
          {'id': 'triangle', 'url': '../remote-data-sources/php/github.php?relativeUrl=/src/views/symbols/triangle.svg?account=' + account + '&branch=' + branch}
        ],
        highlightNodes: [
          {'parameter': 'label', 'parameterValue': 'CRH', 'color': 'red'},
          {'parameter': 'xref', 'parameterValue': '8525,Entrez%20Gene', 'color': '#FF0000'}
        ],
        hiddenElements: [
          'find',
          'wikipathways-link'
        ]
      });
    });
  }

  appendPartialHtml('../src/views/pathvisio-js.html', '../src/views/pathway-template.svg');

</script>
</body>
