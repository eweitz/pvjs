<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <title>Pathvisiojs Testing and Development</title>
  <style type="text/css" media="screen, print, projection">
    body {
      margin:0;
      padding:0;
      color:#000;
      background:lightgray;
    }
    #body {
      //width:960px;
      margin:0 auto;
      background:lightgray;
    }
    #header {
      padding:10px;
      background:lightblue;
    }
    #content-1 {
      float:left;
      //width:220px;
      padding:10px;
      //background:#bfb;
    }
    #content-2 {
      float:right;
      //width:720px;
    }
    #content-2-1 {
      float:left;
      //width:460px;
      padding:10px;
      //background:#ddf;
    }
    #content-2-2 {
      float:right;
      width:220px;
      padding:10px;
      background:lightyellow;
    }
    #footer {
      padding:10px;
      background:lightgreen;
    }
    /* Easy clearing of floats (see http://positioniseverything.net/easyclearing.html) */
    .cf:after {
      display:block;
      clear:both;
      height:0;
      visibility:hidden;
      content:" ";
      font-size:0;
    }
    /* Does not validate â€“ use conditional comments for this bit if you want valid CSS */
    .cf {*zoom:1;}
  </style>

  <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" media="screen">
  <link rel="stylesheet" href="http://wikipathways.github.io/pathvisiojs/src/css/pathvisio-js.css" media="screen">
  <link rel="stylesheet" href="http://wikipathways.github.io/pathvisiojs/src/css/annotation.css" media="screen">
  <link rel="stylesheet" href="http://wikipathways.github.io/pathvisiojs/src/css/pan-zoom.css" media="screen">
  <link rel="stylesheet" href="http://wikipathways.github.io/pathvisiojs/src/css/pathway-template.css" media="screen">

  <script src="http://wikipathways.github.io/pathvisiojs/lib/rgb-color/rgb-color.min.js"></script>
  <script src="http://wikipathways.github.io/pathvisiojs/lib/case-converter/case-converter.min.js"></script>
  <script src="http://wikipathways.github.io/pathvisiojs/lib/async/lib/async.js"></script>
  <script src="http://wikipathways.github.io/pathvisiojs/lib/d3/d3.min.js"></script>
  <script src="http://wikipathways.github.io/pathvisiojs/lib/jquery/jquery.min.js"></script>
  <script src="http://wikipathways.github.io/pathvisiojs/lib/jquery-ui/ui/minified/jquery-ui.min.js"></script>
  <script src="http://wikipathways.github.io/pathvisiojs/lib/typeahead.js/dist/typeahead.min.js"></script>
  <script src="http://wikipathways.github.io/pathvisiojs/lib/openseadragon/openseadragon.min.js"></script>
  <script src="http://wikipathways.github.io/pathvisiojs/lib/modernizr/modernizr.js"></script>
  <script src="http://wikipathways.github.io/pathvisiojs/lib/screenfull/dist/screenfull.min.js"></script>
  <script src="http://wikipathways.github.io/pathvisiojs/lib/svg-pan/svg-pan.js"></script>
  <script src="http://wikipathways.github.io/pathvisiojs/build/js/pathvisio.min.js"></script>


  <!--[if lt IE 9]>
  <script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script>
  <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <script src="../lib/es5-shim/es5-shim.js"></script>
  <script src="../lib/Xccessors/xccessors-standard.js"></script>

  <script>

    // IE8 only allows console.log when Developer Tools is open. This will prevent errors
    // from showing up if I use console.log without DevTools being open.
    // from http://stackoverflow.com/questions/3326650/console-is-undefined-error-for-internet-explorer

    /**
    * Protect window.console method calls, e.g. console is not defined on IE
    * unless dev tools are open, and IE doesn't define console.debug
    */
    (function() {
    if (!window.console) {
    window.console = {};
    }
    // union of Chrome, FF, IE, and Safari console methods
    var m = [
    "log", "info", "warn", "error", "debug", "trace", "dir", "group",
    "groupCollapsed", "groupEnd", "time", "timeEnd", "profile", "profileEnd",
    "dirxml", "assert", "count", "markTimeline", "timeStamp", "clear"
    ];
    // define undefined methods as noops to prevent errors
    for (var i = 0; i < m.length; i++) {
    if (!window.console[m[i]]) {
    window.console[m[i]] = function() {};
    }    
    } 
    })();
  </script>
  <![endif]-->

  <script>
    function getUrlParam(name) {

      // Thanks to http://stackoverflow.com/questions/11582512/how-to-get-url-parameters-with-javascript
      // This will be replaced once we get the backend php to get the json

      var parameter = decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null;
      if (!!parameter) {
      return parameter;
      }
      else {
      return null;
      }
      }

      function getUrlParamList() {
      urlParamList = {
      'svg-disabled': false,
      'gpml': null,
      'gpmlRev': 0,
      'creator': 'pathvisio-js-dev',
      'account': '',
      'branch': ''
      };

      Object.keys(urlParamList).forEach(function(element) {
      if (!!getUrlParam(element)) {
      urlParamList[element] = getUrlParam(element);
      }
      window.setTimeout(function() {
      $('#' + element).val(urlParamList[element]);
      }, 50)
      });

      return urlParamList;
      }

      function updateParams(updatedParam) {
      var targetUrl = currentUrl + '?' + updatedParam.key + '=' + updatedParam.value;

      Object.keys(urlParamList).forEach(function(element) {
      if (element === updatedParam.key) {
      urlParamList[element] = updatedParam.value;
      }
      else {
      targetUrl += '&' + element + '=' + urlParamList[element];
      }
      });

      location.href = targetUrl;
      }

      var urlParamList = getUrlParamList();

      var currentUrl = document.location.origin + document.location.pathname;
      var rootDirectoryUrl = document.location.origin + document.location.pathname.split("pathvisiojs/")[0] + 'pathvisiojs/';
      var srcDirectoryUrl = (rootDirectoryUrl + 'src/');

      var pathvisioNS;
      var gpmlUrl;
      window.onload = function() {
      if (urlParamList['svg-disabled']) {
      Modernizr.svg = false;
      $('#svg-disabled').prop('checked', true);
      }

      pathvisiojs.load({
        target: '#pathvisio-js-dev',
        width: 1000,
        height: 500,
        preserveAspectRatio: 'xMidYMid',
        data: urlParamList.gpml,
        //gpmlRev: urlParamList.gpmlRev,
        //cssUrl: srcDirectoryUrl + 'css/pathway-template.css',
        //customMarkers: customMarkers,
        //customShapes: customShapes,
        highlightNodes: [
          {'parameter': 'label', 'parameterValue': 'CRH', 'color': 'red'},
          {'parameter': 'xref', 'parameterValue': '8525,Entrez%20Gene', 'color': '#FF0000'}
        ],
        hiddenElements: [
        'find',
        'wikipathways-link'
        ]
      });

      // test for whether urlParamList.gpml is a WikiPathways ID

      if (urlParamList.gpml.indexOf('.gpml') === -1 && urlParamList.gpml.indexOf('.xml') === -1) {
      window.setTimeout(function() {
      $('#current-wikipathways-viewer').prepend('<iframe id="current-wiki-pathways-widget" src="http://test.wikipathways.org/wpi/PathwayWidget.php?id=' + urlParamList.gpml + '" width="500px" height="500px" />')
        }, 50);
        }
        else {
        console.warn('Error: GPML data source specified is not a WP ID. WP widget cannot display this GPML data as a pathway image.');
        }
        }
      </script>


    </head>
    <body>
      <div id="body">
        <div id="header" class="cf">
          <h1>Pathvisiojs Testing and Development</h1>
        </div>
        <div id="main" class="cf">
          <div id="content-1">
            <div id="pathvisio-js-dev" style="width: 500px; height: 500px; border:1px solid black; ">
            </div>
          </div>
          <div id="content-2">
            <div id="content-2-1">
              <div id="current-wikipathways-viewer" style="float:left; width: 500px; height: 500px; border:1px solid black; ">
              </div>
            </div>
            <div id="content-2-2">
              <form id="choose-source-data" action="#" method="get">
                GPML (WP ID or a full URL): <input type="text" id="gpml" name="gpml" style="width: 200px;" />
                <input type="hidden" id="gpml-rev" name="gpml-rev" value="0" placeholder="optional" style="width: 100px;" />
                <input type="hidden" id="creator" name="creator" />
                SVG Disabled: <input type="checkbox" id="svg-disabled" name="svg-disabled" value="true" />
                <input type="submit" value="Submit" />
              </form>
            </div>
          </div>
        </div>
        <div id="footer" class="cf">
          <p>(c) WikiPathways 2013</p>
        </div>
      </div>

    </body>
