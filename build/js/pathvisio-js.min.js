function RGBColor(color_string){color_string=color_string.toString(),this.ok=!1,"#"==color_string.charAt(0)&&(color_string=color_string.substr(1,6)),color_string=color_string.replace(/ /g,""),color_string=color_string.toLowerCase();var simple_colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var key in simple_colors)color_string==key&&(color_string=simple_colors[key]);for(var color_defs=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(bits){return[parseInt(bits[1]),parseInt(bits[2]),parseInt(bits[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(bits){return[parseInt(bits[1],16),parseInt(bits[2],16),parseInt(bits[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(bits){return[parseInt(bits[1]+bits[1],16),parseInt(bits[2]+bits[2],16),parseInt(bits[3]+bits[3],16)]}}],i=0;i<color_defs.length;i++){var re=color_defs[i].re,processor=color_defs[i].process,bits=re.exec(color_string);bits&&(channels=processor(bits),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var r=this.r.toString(16),g=this.g.toString(16),b=this.b.toString(16);return 1==r.length&&(r="0"+r),1==g.length&&(g="0"+g),1==b.length&&(b="0"+b),"#"+r+g+b},this.getHelpXML=function(){for(var examples=new Array,i=0;i<color_defs.length;i++)for(var example=color_defs[i].example,j=0;j<example.length;j++)examples[examples.length]=example[j];for(var sc in simple_colors)examples[examples.length]=sc;var xml=document.createElement("ul");xml.setAttribute("id","rgbcolor-examples");for(var i=0;i<examples.length;i++)try{var list_item=document.createElement("li"),list_color=new RGBColor(examples[i]),example_div=document.createElement("div");example_div.style.cssText="margin: 3px; border: 1px solid black; background:"+list_color.toHex()+"; "+"color:"+list_color.toHex(),example_div.appendChild(document.createTextNode("test"));var list_item_value=document.createTextNode(" "+examples[i]+" -> "+list_color.toRGB()+" -> "+list_color.toHex());list_item.appendChild(example_div),list_item.appendChild(list_item_value),xml.appendChild(list_item)}catch(e){}return xml}}var JXON=new function(){function parseText(sValue){return rIsNull.test(sValue)?null:rIsBool.test(sValue)?"true"===sValue.toLowerCase():sValue}function EmptyTree(){}function objectify(vVal){return null===vVal?new EmptyTree:vVal instanceof Object?vVal:new vVal.constructor(vVal)}function createObjTree(oParentNode,nVerb,bFreeze,bNesteAttr){var sProp,vContent,nLevelStart=aCache.length,bChildren=oParentNode.hasChildNodes(),bAttributes=oParentNode.hasAttributes(),bHighVerb=Boolean(2&nVerb),nLength=0,sCollectedTxt="",vResult=bHighVerb?{}:!0;if(bChildren)for(var oNode,nItem=0;nItem<oParentNode.childNodes.length;nItem++)oNode=oParentNode.childNodes.item(nItem),4===oNode.nodeType?sCollectedTxt+=oNode.nodeValue:3===oNode.nodeType?sCollectedTxt+=oNode.nodeValue.trim():1!==oNode.nodeType||oNode.prefix||aCache.push(oNode);var nLevelEnd=aCache.length,vBuiltVal=parseText(sCollectedTxt);bHighVerb||!bChildren&&!bAttributes||(vResult=0===nVerb?objectify(vBuiltVal):{});for(var nElId=nLevelStart;nLevelEnd>nElId;nElId++)sProp=aCache[nElId].nodeName.toLowerCase(),vContent=createObjTree(aCache[nElId],nVerb,bFreeze,bNesteAttr),vResult.hasOwnProperty(sProp)?(vResult[sProp].constructor!==Array&&(vResult[sProp]=[vResult[sProp]]),vResult[sProp].push(vContent)):(vResult[sProp]=vContent,nLength++);if(bAttributes){for(var oAttrib,nAttrLen=oParentNode.attributes.length,sAPrefix=bNesteAttr?"":sAttrsPref,oAttrParent=bNesteAttr?{}:vResult,nAttrib=0;nAttrLen>nAttrib;nLength++,nAttrib++)oAttrib=oParentNode.attributes.item(nAttrib),oAttrParent[sAPrefix+oAttrib.name.toLowerCase()]=parseText(oAttrib.value.trim());bNesteAttr&&(bFreeze&&Object.freeze(oAttrParent),vResult[sAttrProp]=oAttrParent,nLength-=nAttrLen-1)}return 3===nVerb||(2===nVerb||1===nVerb&&nLength>0)&&sCollectedTxt?vResult[sValProp]=vBuiltVal:!bHighVerb&&0===nLength&&sCollectedTxt&&(vResult=vBuiltVal),bFreeze&&(bHighVerb||nLength>0)&&Object.freeze(vResult),aCache.length=nLevelStart,vResult}function loadObjTree(oXMLDoc,oParentEl,oParentObj){var vValue,oChild;oParentObj instanceof String||oParentObj instanceof Number||oParentObj instanceof Boolean?oParentEl.appendChild(oXMLDoc.createTextNode(oParentObj.toString())):oParentObj.constructor===Date&&oParentEl.appendChild(oXMLDoc.createTextNode(oParentObj.toGMTString()));for(var sName in oParentObj)if(vValue=oParentObj[sName],!(isFinite(sName)||vValue instanceof Function))if(sName===sValProp)null!==vValue&&vValue!==!0&&oParentEl.appendChild(oXMLDoc.createTextNode(vValue.constructor===Date?vValue.toGMTString():String(vValue)));else if(sName===sAttrProp)for(var sAttrib in vValue)oParentEl.setAttribute(sAttrib,vValue[sAttrib]);else if(sName.charAt(0)===sAttrsPref)oParentEl.setAttribute(sName.slice(1),vValue);else if(vValue.constructor===Array)for(var nItem=0;nItem<vValue.length;nItem++)oChild=oXMLDoc.createElement(sName),loadObjTree(oXMLDoc,oChild,vValue[nItem]),oParentEl.appendChild(oChild);else oChild=oXMLDoc.createElement(sName),vValue instanceof Object?loadObjTree(oXMLDoc,oChild,vValue):null!==vValue&&vValue!==!0&&oChild.appendChild(oXMLDoc.createTextNode(vValue.toString())),oParentEl.appendChild(oChild)}var sValProp="keyValue",sAttrProp="keyAttributes",sAttrsPref="",aCache=[],rIsNull=/^\s*$/,rIsBool=/^(?:true|false)$/i;EmptyTree.prototype.toString=function(){return"null"},EmptyTree.prototype.valueOf=function(){return null},this.build=function(oXMLParent,nVerbosity,bFreeze,bNesteAttributes){var nVerbMask=arguments.length>1&&"number"==typeof nVerbosity?3&nVerbosity:1;return createObjTree(oXMLParent,nVerbMask,bFreeze||!1,arguments.length>3?bNesteAttributes:3===nVerbMask)},this.unbuild=function(oObjTree){var oNewDoc=document.implementation.createDocument("","",null);return loadObjTree(oNewDoc,oNewDoc,oObjTree),oNewDoc}},pathvisio={};pathvisio.data={},pathvisio.data.current={},pathvisio.data.current.svgSelector=null,pathvisio.data.current.svg=null,pathvisio.data.pathways=[],pathvisio.helpers=function(){function splitStringByNewLine(str){return str.split(/\r\n|\r|\n/g)}function cloneNode(selector){var node=d3.select(selector).node();return d3.select(node.parentNode.insertBefore(node.cloneNode(!0),node.nextSibling))}function getUrlParam(name){var parameter=decodeURIComponent((new RegExp("[?|&]"+name+"="+"([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null;return null!==parameter?parameter:(warn.log("Error: URL not given"),"Error")}function convertToArray(object){if("[object Object]"===Object.prototype.toString.call(object)){var array=[];return array.push(object),array}return"[object Array]"===Object.prototype.toString.call(object)?object:void 0}return{splitStringByNewLine:splitStringByNewLine,getUrlParam:getUrlParam,cloneNode:cloneNode,convertToArray:convertToArray}}(),pathvisio.pathway=function(){function gpml2json(xmlGpml){self.xmlGpml=xmlGpml;var pathway=pathvisio.data.pathways[pathvisio.data.current.svgSelector];pathway=JXON.build(xmlGpml);try{xmlns=pathway.xmlns}catch(e){return console.log(e.message),void 0}var gpmlXmlnsSupported="http://pathvisio.org/GPML/2013a",gpmlXmlnsIdentifier="/GPML/";if(-1===xmlns.indexOf(gpmlXmlnsIdentifier))return alert("Pathvisio.js does not support the data format provided. Please convert to GPML and retry."),console.log("Pathvisio.js does not support the data format provided. Please convert to GPML and retry."),void 0;xmlns!=gpmlXmlnsSupported&&alert("Pathvisio.js may not fully support the version of GPML provided (xmlns: "+xmlns+"). Please convert to the supported version of GPML (xmlns: "+gpmlXmlnsSupported+")."),pathway.boardWidth=pathway.graphics.boardwidth,delete pathway.graphics.boardwidth,pathway.boardHeight=pathway.graphics.boardheight,delete pathway.graphics.boardheight,pathway.hasOwnProperty("last-modified")&&(pathway.lastModified=pathway["last-modified"],delete pathway["last-modified"]),pathway.infoBox=pathway.infobox,delete pathway.infobox,pathway.infoBox.x=0,delete pathway.infoBox.centerx,pathway.infoBox.y=0,delete pathway.infoBox.centery;try{delete pathway.biopax}catch(e){console.log("Biopax error: "+e.message)}try{pathway.hasOwnProperty("biopaxref")?(pathway.biopaxRefs=pathvisio.helpers.convertToArray(pathway.biopaxref),delete pathway.biopaxref):console.log("No element(s) named 'biopaxref' found in this gpml file.")}catch(e){console.log("Error converting biopaxref to json: "+e.message)}try{pathway.hasOwnProperty("comment")?(pathway.comments=pathvisio.helpers.convertToArray(pathway.comment),delete pathway.comment,pathway.comments.forEach(function(){})):console.log("No element(s) named 'comment' found in this gpml file.")}catch(e){console.log("Error converting comment to json: "+e.message)}try{pathway.hasOwnProperty("group")?(pathway.groups=pathvisio.helpers.convertToArray(pathway.group),delete pathway.group,pathway.groups.forEach(function(element){element.graphId=element.graphid,delete element.graphid,element.groupId=element.groupid,delete element.groupid,element.style=element.hasOwnProperty("style")?element.style.toLowerCase():"none"})):console.log("No element(s) named 'group' found in this gpml file.")}catch(e){console.log("Error converting group to json: "+e.message)}try{pathway.hasOwnProperty("graphicalline")?(graphicalLines=pathvisio.helpers.convertToArray(pathway.graphicalline),delete pathway.graphicalline,void 0===pathway.edges&&(pathway.edges=[]),graphicalLines.forEach(function(element){element.edgeType="graphical-line",pathway.edges.push(element)})):console.log("No element(s) named 'graphicalline' found in this gpml file.")}catch(e){console.log("Error converting graphicalline to json: "+e.message)}try{if(pathway.hasOwnProperty("interaction")){var interactions=pathvisio.helpers.convertToArray(pathway.interaction);delete pathway.interaction,void 0===pathway.edges&&(pathway.edges=[]),interactions.forEach(function(element){element.edgeType="interaction",pathway.edges.push(element)}),self.interactions=interactions,self.edges=pathway.edges}else console.log("No element(s) named 'interaction' found in this gpml file.")}catch(e){console.log("Error converting interaction to json: "+e.message)}try{pathway.hasOwnProperty("edges")?pathway.edges=pathvisio.pathway.edge.gpml2json(pathway.edges):console.log("No element(s) named 'edges' found in this gpml file.")}catch(e){console.log("Error converting edges to json: "+e.message)}var dataNodeTypeMappings={GeneProduct:"gene-product",Metabolite:"metabolite",Pathway:"pathway",Protein:"protein",Rna:"rna"};try{if(pathway.hasOwnProperty("datanode")){var dataNodes=pathvisio.helpers.convertToArray(pathway.datanode);delete pathway.datanode,dataNodes.forEach(function(element){element.elementType="data-node",element.dataNodeType=dataNodeTypeMappings.hasOwnProperty(element.type)?dataNodeTypeMappings[element.type]:"unknown",delete element.type,element.hasOwnProperty("xref")&&(element.xRef=element.xref,delete element.xref)}),pathway.labelableElements=pathway.hasOwnProperty("labelableElements")?pathway.labelableElements.concat(dataNodes):dataNodes}else console.log("No element(s) named 'datanode' found in this gpml file.")}catch(e){console.log("Error converting datanode to json: "+e.message)}try{if(pathway.hasOwnProperty("label")){var labels=self.labels=pathvisio.helpers.convertToArray(pathway.label);delete pathway.label,labels.forEach(function(element){element.elementType="label"}),pathway.labelableElements=pathway.hasOwnProperty("labelableElements")?pathway.labelableElements.concat(labels):labels}else console.log("No element(s) named 'label' found in this gpml file.")}catch(e){console.log("Error converting label to json: "+e.message)}try{if(pathway.hasOwnProperty("shape")){var shapes=pathvisio.helpers.convertToArray(pathway.shape);delete pathway.shape,shapes.forEach(function(element){element.elementType="shape"}),pathway.labelableElements=pathway.hasOwnProperty("labelableElements")?pathway.labelableElements.concat(shapes):shapes}else console.log("No element(s) named 'shape' found in this gpml file.")}catch(e){console.log("Error converting shape to json: "+e.message)}try{pathway.hasOwnProperty("labelableElements")?pathway.labelableElements=pathvisio.pathway.labelableElement.gpml2json(pathway.labelableElements):console.log("No element(s) named 'labelableElements' found in this gpml file.")}catch(e){console.log("Error converting labelableElements to json: "+e.message)}delete pathway.graphics,console.log("JSON:"),console.log(pathway),pathvisio.data.pathways[pathvisio.data.current.svgSelector]=pathway}function get(url,mimeType,callback){return void 0!==url&&url&&""!==url?(d3.xml(url,"application/xml",function(gpmlDoc){console.log("gpmlDoc"),console.log(gpmlDoc);var oSerializer=new XMLSerializer,sGpml=oSerializer.serializeToString(gpmlDoc),gpml=gpmlDoc.documentElement;console.log("GPML"),console.log(gpml),pathvisio.pathway.gpml2json(gpml);var sJson=self.sJson=JSON.stringify(pathvisio.data.pathways[pathvisio.data.current.svgSelector],void 0,2);callback(pathvisio.data.pathways[pathvisio.data.current.svgSelector],sGpml,sJson)}),void 0):console.warn("Error: URL not specified.")}function draw(data){function dragmove(d){d.x=d3.event.x,d.y=d3.event.y,d3.select(this).attr("x",d3.event.x).attr("y",d3.event.y)}if(null===data)return console.warn("Error: No url specified for GPML or JSON data.");d3.behavior.drag().on("drag",dragmove),pathvisio.data.current.svg.attr("width",data.boardWidth),pathvisio.data.current.svg.attr("height",data.boardHeight),self.symbolsAvailable=pathvisio.data.current.svg.selectAll("symbol");var markersAvailable=markersAvailable=pathvisio.data.current.svg.selectAll("marker");pathvisio.pathway.group.drawAll(),pathvisio.pathway.edge.drawAll(),pathvisio.pathway.labelableElement.drawAll(),pathvisio.pathway.infoBox.draw()}function load(svgSelector,url,mimeType){if(null===svgSelector)return console.warn("Error: No SVG template selector specified.");pathvisio.data.current.svgSelector=svgSelector,pathvisio.data.current.svg=d3.select(svgSelector);var svgCount=pathvisio.data.current.svg.length;return 1!==svgCount?console.warn("Error: "+svgCount+' SVG template(s) returned with selector "'+svgSelector+'". Please redefined selector so only 1 result is returned.'):(console.log("Successfully loaded SVG pathway template."),null===url?console.warn("Error: No url specified for GPML or JSON data."):(get(url,mimeType,function(data){draw(data)}),void 0))}return{draw:draw,load:load,get:get,gpml2json:gpml2json}}(),pathvisio.pathway.group=function(){function drawAll(){if(pathvisio.data.pathways[pathvisio.data.current.svgSelector].hasOwnProperty("groups")){var validGroups=pathvisio.data.pathways[pathvisio.data.current.svgSelector].groups.filter(function(el){var groupId=el.groupId;return pathvisio.data.pathways[pathvisio.data.current.svgSelector].labelableElements.filter(function(el){return el.groupRef===groupId}).length>0});console.log("validGroups"),console.log(validGroups),console.log("hi"),console.log(pathvisio.data.current.svg),console.log(pathvisio.data.current.svg.selectAll("use.group")),console.log("bye"),pathvisio.data.current.svg.selectAll("use.group").data(validGroups).enter().append("use").attr("id",function(d){return"group-"+d.graphId}).attr("transform",function(d){console.log("hmm");var groupDimensions=getDimensions(d.groupId);return"translate("+groupDimensions.x+" "+groupDimensions.y+")"}).attr("width",function(d){var groupDimensions=getDimensions(d.groupId);return groupDimensions.width}).attr("height",function(d){var groupDimensions=getDimensions(d.groupId);return groupDimensions.height}).attr("class",function(d){return"group group-"+d.style}).attr("xlink:xlink:href",function(d){return"#group-"+d.style})}}function getDimensions(groupId){var groupMembers=pathvisio.data.pathways[pathvisio.data.current.svgSelector].labelableElements.filter(function(el){return el.groupRef===groupId}),group={},margin=12;return group.x=d3.min(groupMembers,function(el){return el.x})-margin,group.y=d3.min(groupMembers,function(el){return el.y})-margin,group.width=d3.max(groupMembers,function(el){return el.x+el.width})-group.x+margin,group.height=d3.max(groupMembers,function(el){return el.y+el.height})-group.y+margin,group}return{drawAll:drawAll,getDimensions:getDimensions}}(),pathvisio.pathway.infoBox=function(){function draw(){var infoBox=[];pathvisio.data.pathways[pathvisio.data.current.svgSelector].hasOwnProperty("name")&&infoBox.push({key:"Title",value:pathvisio.data.pathways[pathvisio.data.current.svgSelector].name}),pathvisio.data.pathways[pathvisio.data.current.svgSelector].hasOwnProperty("license")&&infoBox.push({key:"Availability",value:pathvisio.data.pathways[pathvisio.data.current.svgSelector].license}),pathvisio.data.pathways[pathvisio.data.current.svgSelector].hasOwnProperty("lastModified")&&infoBox.push({key:"Last modified",value:pathvisio.data.pathways[pathvisio.data.current.svgSelector].lastModified}),pathvisio.data.pathways[pathvisio.data.current.svgSelector].hasOwnProperty("organism")&&infoBox.push({key:"Organism",value:pathvisio.data.pathways[pathvisio.data.current.svgSelector].organism});var infoBoxElements=pathvisio.data.current.svg.selectAll("text.info-box").data(infoBox).enter().append("text").attr("id",function(d,i){return"info-box-"+i}).attr("class","info-box").attr("x",0).attr("y",function(d,i){return 14+14*i});infoBoxElements.append("tspan").attr("class","info-box-property-name").text(function(d){return d.key+": "}),infoBoxElements.append("tspan").text(function(d){return d.value})}return{draw:draw}}(),pathvisio.pathway.labelableElement=function(){function gpml2json(rawJsonLabelableElements){try{rawJsonLabelableElements.forEach(function(element){if(element.graphId=element.graphid,delete element.graphid,element.hasOwnProperty("groupref")&&(element.groupRef=element.groupref,delete element.groupref),element.hasOwnProperty("comment")&&(element.comments=pathvisio.helpers.convertToArray(element.comment),delete element.comment),element.hasOwnProperty("xref")&&null===element.xref.database&&null===element.xref.id&&delete element.xref,element.graphics.hasOwnProperty("zorder")&&(element.zIndex=parseFloat(element.graphics.zorder)),element.x=parseFloat(element.graphics.centerx)-parseFloat(element.graphics.width)/2,element.y=parseFloat(element.graphics.centery)-parseFloat(element.graphics.height)/2,element.width=parseFloat(element.graphics.width),element.height=parseFloat(element.graphics.height),element.graphics.hasOwnProperty("color")){var color=new RGBColor(element.graphics.color);color.ok?element.stroke=color.toHex():(console.warn("Invalid Color encountered. Setting Color to black."),element.fill="#000000")}if(element.symbolType=element.graphics.hasOwnProperty("shapetype")?shapeMappings[element.graphics.shapetype]:"data-node"===element.elementType?"rectangle":"none",element.graphics.hasOwnProperty("fillcolor"))if(element.graphics.fillcolor=element.graphics.fillcolor.toLowerCase(),"transparent"===element.graphics.fillcolor)element.fillOpacity=0;else{var fill=new RGBColor(element.graphics.fillcolor);fill.ok?element.fill=fill.toHex():(console.warn("Invalid FillColor encountered. Setting FillColor to gray."),element.fill="#999999"),"none"!==element.symbolType&&(element.fillOpacity=1)}if(element.graphics.hasOwnProperty("linethickness")&&(element.strokeWidth=element.graphics.linethickness),element.graphics.hasOwnProperty("linestyle")&&(element.strokeStyle=element.graphics.linestyle.toLowerCase(),"broken"===element.strokeStyle&&(element.strokeStyle="dashed"),delete element.graphics.linestyle),element.hasOwnProperty("attribute")&&(element.attributes=pathvisio.helpers.convertToArray(element.attribute),delete element.attribute,element.attributes.forEach(function(el){"org.pathvisio.DoubleLineProperty"===el.key&&"Double"===el.value?el.strokeStyle="double":"org.pathvisio.CellularComponentProperty"===el.key&&"None"!==el.value&&(element.cellularComponent=el.value)}),delete element.attributes),element.graphics.hasOwnProperty("rotation")&&(element.rotation=element.graphics.rotation*(180/Math.PI)),element.hasOwnProperty("textlabel"))if(null===element.textlabel)delete element.textlabel;else{var text=element.textlabel.toString().replace("&#xA;","\r\n");if(delete element.textlabel,element.textLabel={},element.textLabel.text=text,element.hasOwnProperty("groupref")&&(element.groupRef=element.groupref,delete element.groupref),element.hasOwnProperty("stroke")&&(element.textLabel.fill=element.stroke),element.graphics.hasOwnProperty("fontsize"))var fontSize=element.graphics.fontsize;else var fontSize=10;element.textLabel.fontSize=fontSize,element.graphics.hasOwnProperty("fontname")&&(element.textLabel.fontFamily=element.graphics.fontname),element.graphics.hasOwnProperty("fontweight")&&(element.textLabel.fontWeight=element.graphics.fontweight.toLowerCase()),element.graphics.hasOwnProperty("fontstyle")&&(element.textLabel.fontStyle=element.graphics.fontstyle.toLowerCase()),element.textLabel.textAnchor=alignToAnchorMappings.hasOwnProperty(element.graphics.align)?alignToAnchorMappings[element.graphics.align]:"middle",element.textLabel.vAlign=element.graphics.hasOwnProperty("valign")?element.graphics.valign.toLowerCase():"top"}delete element.graphics});var validJsonLabelableElements=rawJsonLabelableElements.sort(function(a,b){return a.zIndex-b.zIndex});return validJsonLabelableElements}catch(e){return console.log("Error //converting labelable elements to json: "+e.message),e}}function drawAll(){var labelableElementsContainer=pathvisio.data.current.svg.selectAll("g.labelable-elements-container").data(pathvisio.data.pathways[pathvisio.data.current.svgSelector].labelableElements).enter().append("g").attr("id",function(d){return"labelable-elements-container-"+d.graphId}).attr("transform",function(d){return"translate("+d.x+" "+d.y+")"}).attr("class","labelable-elements-container").on("click",function(d){if("data-node"===d.elementType){var xrefDiv=$(".xrefinfo"),xrefHtml=XrefPanel.create(d.xRef.id,d.xRef.database,"Homo sapiens",d.textLabel.text);window.setTimeout(function(){xrefDiv.empty(),xrefDiv.append(xrefHtml)},2e3)}});labelableElementsContainer.each(function(d){var labelableElement=d3.select(this).append("use").attr("id",function(d){return"labelable-element-"+d["@GraphId"]}).attr("transform",function(d){var transform="none";return d.hasOwnProperty("rotation")&&(transform="rotate("+d.rotation+" "+d.width/2+" "+d.height/2+")"),transform}).attr("class",function(d){var styleClass="";return styleClass="data-node"===d.elementType?"labelable-element "+d.elementType+" "+d.dataNodeType:"labelable-element "+d.elementType}).attr("x",0).attr("y",0).attr("width",function(d){return d.width}).attr("height",function(d){return d.height}).attr("z-index",function(d){return d.zIndex}).attr("style",function(d){var style="";return d.hasOwnProperty("fill")&&(style+="fill:"+d.fill+"; "),d.hasOwnProperty("fillOpacity")&&(style+="fill-opacity:"+d.fillOpacity+"; "),d.hasOwnProperty("stroke")&&(style+="stroke:"+d.stroke+"; "),d.hasOwnProperty("strokeWidth")?style+="stroke-width:"+2*d.strokeWidth+"; ":"none"!==d.symbolType&&(style+="stroke-width: 2; "),d.hasOwnProperty("strokeStyle")&&"dashed"===d.strokeStyle&&(style+="stroke-dasharray: 5,3; "),style});if(symbolsAvailable.filter(function(d,i){return symbolsAvailable[0][i].id===pathvisio.data.pathways[pathvisio.data.current.svgSelector].labelableElements[0].symbolType}).length>0?labelableElement.attr("xlink:xlink:href",function(d){return"#"+d.symbolType}):(labelableElement.attr("xlink:xlink:href","#rectangle"),console.log("Pathvisio.js does not have access to the requested symbol: "+pathvisio.data.pathways[pathvisio.data.current.svgSelector].labelableElements[0].symbolType+". Rectangle used as placeholder.")),d.hasOwnProperty("textLabel")){var labelableElementText=d3.select(this).append("text").attr("id",function(d){return"labelable-element-text-"+d.graphId}).attr("x",0).attr("y",0).attr("transform",function(d){if(d.textLabel.hasOwnProperty("textAnchor"))if("start"===d.textLabel.textAnchor)var dx=5;else if("end"===d.textLabel.textAnchor)var dx=d.width-5;else var dx=d.width/2;else var dx=d.width/2;if(d.textLabel.hasOwnProperty("vAlign"))if("top"===d.textLabel.vAlign)var dy=5+1*d.textLabel.fontSize;else if("bottom"===d.textLabel.vAlign)var dy=d.height-(5+.3*d.textLabel.fontSize+(pathvisio.helpers.splitStringByNewLine(d.textLabel.text).length-1)*d.textLabel.fontSize);else var dy=d.height/2+.3*d.textLabel.fontSize-(pathvisio.helpers.splitStringByNewLine(d.textLabel.text).length-1)*d.textLabel.fontSize/2;else var dy=d.height/2+.3*d.textLabel.fontSize-(pathvisio.helpers.splitStringByNewLine(d.textLabel.text).length-1)*d.textLabel.fontSize/2;return"translate("+dx+" "+dy+")"}).attr("class",function(d){var styleClass="";return"data-node"===d.elementType&&(styleClass=d.dataNodeType),styleClass}).attr("style",function(d){var style="";return d.fontSize,d.textLabel.hasOwnProperty("fill")&&(style+="fill:"+d.textLabel.fill+"; "),d.textLabel.hasOwnProperty("fontFamily")&&(style+="font-family:"+d.textLabel.fontFamily+"; "),d.textLabel.hasOwnProperty("fontSize")&&(style+="font-size:"+d.textLabel.fontSize+"px; "),d.textLabel.hasOwnProperty("fontWeight")&&(style+="font-weight:"+d.textLabel.fontWeight+"; "),d.textLabel.hasOwnProperty("fontStyle")&&(style+="font-style:"+d.textLabel.fontStyle+"; "),d.textLabel.hasOwnProperty("textAnchor")&&(style+="text-anchor:"+d.textLabel.textAnchor+"; "),style});labelableElementText.each(function(d){var fontSize=d.textLabel.fontSize;d3.select(this).selectAll("tspan").data(function(d){var textArray=pathvisio.helpers.splitStringByNewLine(d.textLabel.text);return textArray}).enter().append("tspan").attr("x",0).attr("y",function(d,i){return i*fontSize}).text(function(d){return d})})}})}function getPortCoordinates(boxDimensions,relX,relY){var port={};return port.x=boxDimensions.x+relX*boxDimensions.width,port.y=boxDimensions.y+relY*boxDimensions.height,port}var shapeMappings={Arc:"arc",Brace:"brace",Cell:"cell","Endoplasmic Reticulum":"endoplasmic-reticulum","Extracellular region":"extracellular-region","Golgi Apparatus":"golgi-apparatus",Hexagon:"hexagon","mim-degradation":"mim-degradation",Mitochondria:"mitochondria",Nucleus:"nucleus",Organelle:"organelle",Oval:"oval",Pentagon:"pentagon",Rectangle:"rectangle",RoundedRectangle:"rounded-rectangle","Sarcoplasmic Reticulum":"sarcoplasmic-reticulum",Triangle:"triangle",Vesicle:"vesicle"},alignToAnchorMappings={Left:"start",Center:"middle",Right:"end"};return{drawAll:drawAll,getPortCoordinates:getPortCoordinates,gpml2json:gpml2json}}(),pathvisio.pathway.edge=function(){function gpml2json(rawJsonEdges){function attachedToAnchor(point,edges){var i=-1;do{i+=1;var anchor=edges[i].anchors.filter(function(element){return element.graphId===point.graphRef})[0]}while(void 0===anchor&&i<edges.length-1);return void 0!==anchor}try{rawJsonEdges.forEach(function(element){if(element.graphId=element.graphid,delete element.graphid,element.hasOwnProperty("groupref")&&(element.groupRef=element.groupref,delete element.groupref),element.graphics.hasOwnProperty("anchor")&&(element.anchors=pathvisio.helpers.convertToArray(element.graphics.anchor),element.anchors.forEach(function(el){el.graphId=el.graphid,delete el.graphid})),element.graphics.hasOwnProperty("color")){var color=new RGBColor(element.graphics.color);color.ok&&(element.stroke=color.toHex())}element.strokeWidth=element.graphics.linethickness,element.graphics.hasOwnProperty("connectortype")&&(element.connectorType=element.graphics.connectortype.toLowerCase()),element.graphics.hasOwnProperty("linestyle")?(element.strokeStyle=element.graphics.linestyle.toLowerCase(),"broken"===element.strokeStyle&&(element.strokeStyle="dashed"),delete element.graphics.linestyle):element.hasOwnProperty("attribute")&&"org.pathvisio.DoubleLineProperty"===element.attribute.key&&"Double"===element.attribute.value&&(element.strokeStyle="double",delete element.attribute),element.zIndex=element.graphics.zorder,element.xRef=element.xref,delete element.xref;var points=pathvisio.helpers.convertToArray(element.graphics.point),pointsData=pathvisio.pathway.edge.point.gpml2json(points);element.points=pointsData.points,element.markerStart=pointsData.markerStart,element.markerEnd=pointsData.markerEnd,delete element.graphics}),rawJsonEdges.sort(function(a,b){return a.zIndex-b.zIndex});var edgesWithAnchors=[],edgesWithoutAnchors=[];rawJsonEdges.forEach(function(element){element.hasOwnProperty("anchors")?edgesWithAnchors.push(element):edgesWithoutAnchors.push(element)});var validJsonEdges=[],unsortedJsonEdges=edgesWithAnchors;unsortedJsonEdges.forEach(function(element,index,array){attachedToAnchor(element.points[0],edgesWithAnchors)||attachedToAnchor(element.points[element.points.length-1],edgesWithAnchors)||(validJsonEdges.push(element),array.splice(index,1))});do unsortedJsonEdges.forEach(function(element,index,array){attachedToAnchor(element.points[0],edgesWithAnchors)&&!attachedToAnchor(element.points[0],validJsonEdges)||!attachedToAnchor(element.points[element.points.length-1],validJsonEdges)&&attachedToAnchor(element.points[element.points.length-1],edgesWithAnchors)||(validJsonEdges.push(element),array.splice(index,1))
});while(unsortedJsonEdges.length>0);return validJsonEdges=validJsonEdges.concat(edgesWithoutAnchors)}catch(e){return console.log("Error converting edge to json: "+e.message),e}}function drawAll(){if(pathvisio.data.pathways[pathvisio.data.current.svgSelector].hasOwnProperty("edges")){var pathData=null;pathvisio.data.current.svg.selectAll("pathway.edge").data(pathvisio.data.pathways[pathvisio.data.current.svgSelector].edges).enter().append("path").attr("id",function(d){return d.edgeType+"-"+d.graphId}).attr("class",function(d){var styleClass="edge "+d.edgeType+" ";return d.hasOwnProperty("strokeStyle")&&"dashed"===d.strokeStyle&&(styleClass+=" dashed-stroke"),styleClass}).attr("d",function(d){return pathData=pathvisio.pathway.edge.pathData.get(d),d.hasOwnProperty("strokeStyle")&&"double"===d.strokeStyle&&pathvisio.data.current.svg.append("path").attr("class",d.edgeType+"-double").attr("d",pathData).attr("class","drawing-board-color-stroke").attr("style","stroke-width:"+d.strokeWidth+"; ").attr("marker-start","url(#"+pathvisio.pathway.edge.marker.draw(d.markerStart,"start",d.stroke)+")").attr("marker-end","url(#"+pathvisio.pathway.edge.marker.draw(d.markerEnd,"end",d.stroke)+")"),pathData}).attr("style",function(d){var style="stroke-width:"+d.strokeWidth+"; ";return d.hasOwnProperty("stroke")&&(style+="stroke:"+d.stroke+"; "),d.hasOwnProperty("strokeStyle")&&"double"===d.strokeStyle&&(style+="stroke-width:"+3*d.strokeWidth+"; "),style}).attr("marker-start",function(d){return markerStart=pathvisio.pathway.edge.marker.draw(d.markerStart,"start",d.stroke),d.hasOwnProperty("strokeStyle")&&"double"===d.strokeStyle&&(markerStart="double-line-hack-start"),"url(#"+markerStart+")"}).attr("marker-end",function(d){return markerEnd=pathvisio.pathway.edge.marker.draw(d.markerEnd,"end",d.stroke),d.hasOwnProperty("strokeStyle")&&"double"===d.strokeStyle&&(markerEnd="double-line-hack-end"),"url(#"+markerEnd+")"}).attr("fill","none")}}return{gpml2json:gpml2json,drawAll:drawAll}}(),pathvisio.pathway.edge.marker=function(){function draw(name,position,color){var markerName="";if("none"===name)markerName=name;else if("#000"!==color&&"#000000"!==color&&color){var markerElementBlack=pathvisio.data.current.svg.select("marker#"+name+"-"+position+"-black"),markerElement=pathvisio.helpers.cloneNode(markerElementBlack[0][0]),markerElementStyle="";"black"===markerElement[0][0].getAttribute("stroke")&&(markerElementStyle+="stroke:"+color+"; "),"black"===markerElement[0][0].getAttribute("fill")&&(markerElementStyle+="fill:"+color+"; "),markerElement[0][0].setAttribute("id",name+"-"+position+"-"+color),markerElement[0][0].setAttribute("style",markerElementStyle),markerName=name+"-"+position+"-"+color}else markerName=name+"-"+position+"-black";return markerName}return{draw:draw}}(),pathvisio.pathway.edge.point=function(){function gpml2json(rawJsonPoints){try{var markerStart="none",markerEnd="none";rawJsonPoints.forEach(function(element,index,array){if(void 0!==element.graphref){element.graphRef=element.graphref,delete element.graphref;var relx=(Math.round(2*element.relx)/2).toString();element.relX=parseFloat(anchorPositionMappings[relx]),delete element.relx,delete element.x;var rely=(Math.round(2*element.rely)/2).toString();element.relY=parseFloat(anchorPositionMappings[rely]),delete element.rely,delete element.y,0===element.relX?element.dx=-1:1===element.relX?element.dx=1:0===element.relY?element.dy=-1:1===element.relY&&(element.dy=1)}0===index&&markerMappings.hasOwnProperty(element.arrowhead)?(markerStart=markerMappings[element.arrowhead],delete element.arrowhead):index===array.length-1&&markerMappings.hasOwnProperty(element.arrowhead)&&(markerEnd=markerMappings[element.arrowhead],delete element.arrowhead)});var validJsonPoints=rawJsonPoints;return{points:validJsonPoints,markerStart:markerStart,markerEnd:markerEnd}}catch(e){return console.log("Error converting point to json: "+e.message),e}}function getGraphRef(point){if(self.point=point,point.hasOwnProperty("graphRef")){if(pathvisio.data.pathways[pathvisio.data.current.svgSelector].hasOwnProperty("labelableElements")){var labelableElement=pathvisio.data.pathways[pathvisio.data.current.svgSelector].labelableElements.filter(function(element){return element.graphId===point.graphRef})[0];if(void 0!==labelableElement)return{type:"labelableElement",element:labelableElement}}if(pathvisio.data.pathways[pathvisio.data.current.svgSelector].hasOwnProperty("groups")){var group=pathvisio.data.pathways[pathvisio.data.current.svgSelector].groups.filter(function(element){return element.graphId===point.graphRef})[0];if(void 0!==group)return{type:"group",groupId:group.groupId}}var edgesWithAnchors=pathvisio.data.pathways[pathvisio.data.current.svgSelector].edges.filter(function(element){return element.hasOwnProperty("anchors")});self.edgesWithAnchors=edgesWithAnchors;var i=-1;do{i+=1;var anchor=edgesWithAnchors[i].anchors.filter(function(element){return element.graphId===point.graphRef})[0]}while(void 0===anchor&&i<edgesWithAnchors.length);return{type:"anchor",element:anchor,edge:edgesWithAnchors[i]}}return{type:"unconnected"}}function getCoordinates(point){var coordinates={},edgeTerminusRef=self.edgeTerminusRef=getGraphRef(point);if("anchor"!==edgeTerminusRef.type)if("unconnected"===edgeTerminusRef.type)coordinates.x=point.x,coordinates.y=point.y;else if("labelableElement"===edgeTerminusRef.type)var coordinates=pathvisio.pathway.labelableElement.getPortCoordinates(edgeTerminusRef.element,point.relX,point.relY);else{if("group"!==edgeTerminusRef.type)return"error";var groupDimensions=pathvisio.pathway.group.getDimensions(edgeTerminusRef.groupId),coordinates=pathvisio.pathway.labelableElement.getPortCoordinates(groupDimensions,point.relX,point.relY)}else var path=d3.select("#interaction-"+edgeTerminusRef.edge.graphId)[0][0],coordinates=path.getPointAtLength(edgeTerminusRef.element.position*path.getTotalLength());return coordinates}function isTwoPointElbow(source,target){var isRightAngle=Math.abs(source.dx)===Math.abs(target.dy)&&Math.abs(source.dy)===Math.abs(target.dx),sourcePasses=(target.x-source.x)/Math.abs(target.x-source.x)===source.dx||(target.y-source.y)/Math.abs(target.y-source.y)===source.dy,targetPasses=(source.x-target.x)/Math.abs(source.x-target.x)===target.dx||(source.y-target.y)/Math.abs(source.y-target.y)===target.dy;return isRightAngle&&sourcePasses&&targetPasses}var anchorPositionMappings={"-1":0,"-0.5":.333,0:.5,.5:.667,1:1},markerMappings={Arrow:"arrow","mim-branching-left":"mim-branching-left","mim-branching-right":"mim-branching-right","mim-necessary-stimulation":"mim-necessary-stimulation","mim-binding":"mim-binding","mim-conversion":"mim-conversion","mim-stimulation":"mim-stimulation","mim-modification":"mim-modification","mim-catalysis":"mim-catalysis","mim-inhibition":"mim-inhibition","mim-cleavage":"mim-cleavage","mim-covalent-bond":"mim-covalent-bond","mim-transcription-translation":"mim-transcription-translation","mim-gap":"mim-gap",none:"none",TBar:"t-bar"};return{getGraphRef:getGraphRef,getCoordinates:getCoordinates,isTwoPointElbow:isTwoPointElbow,gpml2json:gpml2json}}(),pathvisio.pathway.edge.pathData=function(){function get(d){function switchDirection(currentDirection){return"H"===currentDirection?"V":"H"}var sourcePoint=d.points[0],source=pathvisio.pathway.edge.point.getCoordinates(sourcePoint);source.dx=void 0===sourcePoint.dx?0:sourcePoint.dx,source.dy=void 0===sourcePoint.dy?0:sourcePoint.dy;var targetPoint=d.points[d.points.length-1],target=pathvisio.pathway.edge.point.getCoordinates(targetPoint);target.dx=void 0===targetPoint.dx?0:targetPoint.dx,target.dy=void 0===targetPoint.dy?0:targetPoint.dy;var pathData="M "+source.x+" "+source.y;if(d.connectorType&&void 0!==d.connectorType&&"straight"!==d.connectorType)if("elbow"===d.connectorType&&d.points[0].hasOwnProperty("graphRef")&&d.points[d.points.length-1].hasOwnProperty("graphRef"))currentDirection=1===Math.abs(source.dx)?"H":"V",2===d.points.length&&pathvisio.pathway.edge.point.isTwoPointElbow(source,target)||(d.points.length>2?d.points.forEach(function(element,index,array){index>0&&index<array.length-1&&(pathData+="H"===currentDirection?" "+currentDirection+" "+element.x:" "+currentDirection+" "+element.y,currentDirection=switchDirection(currentDirection))}):(1===Math.abs(source.dx)?pathData+=" H "+(source.x+15*source.dx):1===Math.abs(source.dy)&&(pathData+=" V "+(source.y+15*source.dy),currentDirection=switchDirection(currentDirection)),target.dx===(target.x-source.x)/Math.abs(target.x-source.x)||source.dx===target.dy||source.dy===target.dx?(pathData+=" H "+(target.x+15*target.dx)+" V "+target.y+" H "+target.x,currentDirection=switchDirection(currentDirection)):(target.dy===(target.y-source.y)/Math.abs(target.y-source.y)||source.dx===target.dy||source.dy===target.dx)&&(pathData+=" V "+(target.y+15*target.dy)+" H "+target.x+" V "+target.y,currentDirection=switchDirection(currentDirection)))),"H"===currentDirection?(pathData+=" "+currentDirection+" "+target.x,currentDirection=switchDirection(currentDirection),pathData+=" "+currentDirection+" "+target.y,currentDirection=switchDirection(currentDirection)):(pathData+=" "+currentDirection+" "+target.y,currentDirection=switchDirection(currentDirection),pathData+=" "+currentDirection+" "+target.x,currentDirection=switchDirection(currentDirection));else if("segmented"===d.connectorType)d.points.forEach(function(element,index,array){index>0&&index<array.length-1&&(pathData+=" L "+element.x+" "+element.y)}),pathData+=" L "+target.x+" "+target.y;else{if("curved"===d.connectorType){if(3===d.points.length){var pointControl=d.points[1];return pathData+=" S"+pointControl.x+","+pointControl.y+" "+target.x+","+target.y}return pathData+=" T"+target.x+","+target.y}console.log("Warning: pathvisio.js does not support connector type: "+d.connectorType),d.points.forEach(function(element,index,array){index>0&&index<array.length-1&&(pathData+=" L "+element.x+" "+element.y)}),pathData+=" L "+target.x+" "+target.y}else pathData+=" L "+target.x+" "+target.y;return pathData}return{get:get}}();